<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Password Request Batch 5-JV</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 20px;
}
.container {
  max-width: 420px;
  margin: auto;
  background: #ffffff;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
h2 {
  text-align: center;
}
label {
  font-weight: bold;
}
input[type="text"] {
  width: 100%;
  padding: 10px;
  margin: 5px 0 15px;
  border: 1px solid #ccc;
  border-radius: 5px;
  text-transform: uppercase;
}
.consent {
  font-size: 13px;
  margin-bottom: 15px;
}
button {
  width: 100%;
  padding: 12px;
  background: #25D366;
  color: white;
  border: none;
  border-radius: 5px;
  font-size: 16px;
  cursor: not-allowed;
  opacity: 0.6;
}
button.enabled {
  cursor: pointer;
  opacity: 1;
}
.note {
  font-size: 12px;
  color: #666;
  text-align: center;
  margin-top: 10px;
}

/* ===== SUCCESS ANIMATION ===== */
.successBox {
  display: none;
  text-align: center;
}
.checkmark {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  display: inline-block;
  border: 4px solid #4CAF50;
  position: relative;
  animation: scaleIn 0.5s ease;
}
.checkmark:after {
  content: "";
  position: absolute;
  left: 22px;
  top: 38px;
  width: 20px;
  height: 40px;
  border-right: 4px solid #4CAF50;
  border-bottom: 4px solid #4CAF50;
  transform: rotate(45deg);
}
@keyframes scaleIn {
  0% { transform: scale(0); }
  100% { transform: scale(1); }
}
.ref {
  margin-top: 15px;
  font-weight: bold;
  color: #333;
}
</style>

<script>
var IS_SUBMITTED = false; // double submit lock
</script>
</head>

<body>

<!-- FORM -->
<div class="container" id="formBox">
  <h2>üîê Password Request Batch 5-JV</h2>

  <form onsubmit="return validateAndSend();">
    <label>Company Name</label>
    <input type="text" id="company" required>

    <label>Director Name</label>
    <input type="text" id="director" required>

    <label>Company Reg. No</label>
    <input type="text" id="regno" required>

    <div class="consent">
      <input type="checkbox" id="consent" onclick="toggleButton()">
      I confirm this request is authorized.
    </div>

    <button type="submit" id="sendBtn" disabled>Send Request</button>
  </form>

  <div class="note">Request will be sent via WhatsApp</div>
</div>

<!-- SUCCESS -->
<div class="container successBox" id="successBox">
  <div class="checkmark"></div>
  <h2>Successfully Sent</h2>
  <div class="ref" id="refDisplay"></div>
  <p>Please wait for administrator response.</p>
</div>

<script>
function toggleButton() {
  var btn = document.getElementById("sendBtn");
  btn.disabled = !document.getElementById("consent").checked;
  btn.classList.toggle("enabled", !btn.disabled);
}

function generateReference() {
  var d = new Date();
  return "JV5-" +
    d.getFullYear() +
    String(d.getMonth()+1).padStart(2,"0") +
    String(d.getDate()).padStart(2,"0") + "-" +
    String(d.getHours()).padStart(2,"0") +
    String(d.getMinutes()).padStart(2,"0") +
    String(d.getSeconds()).padStart(2,"0");
}

function validateAndSend() {
  if (IS_SUBMITTED) return false;
  if (!document.getElementById("consent").checked) return false;

  IS_SUBMITTED = true;
  document.getElementById("sendBtn").innerText = "Sending...";
  document.getElementById("sendBtn").disabled = true;

  sendWhatsApp();
  return false;
}

function sendWhatsApp() {
  var company = companyVal = document.getElementById("company").value.toUpperCase();
  var director = document.getElementById("director").value.toUpperCase();
  var regno = document.getElementById("regno").value.toUpperCase();
  var ref = generateReference();
  var time = new Date().toLocaleString();

  var msg =
    "üîê PASSWORD REQUEST BATCH 5-JV\n\n" +
    "Time: " + time + "\n" +
    "Company: " + company + "\n" +
    "Director: " + director + "\n" +
    "Reg No: " + regno + "\n\n" +
    "Ref No: " + ref;

  window.open(
    "https://wa.me/60176701984?text=" + encodeURIComponent(msg),
    "_blank"
  );

  logToGoogleSheet(time, company, director, regno, ref);

  document.getElementById("formBox").style.display = "none";
  document.getElementById("successBox").style.display = "block";
  document.getElementById("refDisplay").innerText = "Reference No: " + ref;
}

/* ===== GOOGLE SHEET LOGGER ===== */
function logToGoogleSheet(time, company, director, regno, ref) {
  fetch("https://script.google.com/macros/s/AKfycbwTIPv4FGKXe0hBI6Nyz5fZw8wUzLUntpDc-nmhqI9r1-4NSVpXkPsGeh93w_6g8SQO/exec", {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      time: time,
      company: company,
      director: director,
      regno: regno,
      ref: ref
    })
  });
}
</script>

</body>
</html>


